<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Dashboard - CryptoChicks</title>
    <link href="/css/output.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com" data-tailwind-config='{"darkMode":"class"}'></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900 flex">
    <script>
      // Prevent access if no token is present
      if (!localStorage.getItem('token')) {
        window.location.href = 'login.html';
      }
    </script>
    <script type="module">
      import { API_BASE, getAuthHeaders } from './javascript/api_url.mjs';
      (async () => {
        const res = await fetch(`${API_BASE}/check-auth`, { headers: getAuthHeaders() });
        if (res.status !== 200) {
          window.location.href = 'login.html';
        }
      })();
    </script>
    <!-- Navbar cargado dinámicamente -->
    <div id="navbar-placeholder"></div>
    <script>
      fetch('./partials/navbar.html')
      .then(res => res.ok ? res.text() : Promise.reject('Error al cargar navbar'))
      .then(html => {
        const container = document.getElementById('navbar-placeholder');
        container.innerHTML = html;
        // Attach logout listener after injection
        const logoutBtn = container.querySelector('#logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', () => {
            console.log('Logout button clicked!');
            localStorage.removeItem('token');
            window.location.href = 'logout.html';
          });
        }
      }) .catch(() => {
          document.getElementById('navbar-placeholder').innerHTML =
            '<div class="fixed w-16 h-screen bg-gray-800 text-white p-4">Error al cargar</div>';
        });
    </script>

    <!-- Main content -->
    <main class="ml-16 group-hover:ml-64 transition-all duration-300 pt-32 px-4 w-full max-w-5xl mx-auto">
      <h1 class="text-3xl text-gray-900 dark:text-white font-bold mb-6">Dashboard</h1>

      <!-- Top Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 text-center">
          <h3 class="text-lg text-gray-900 dark:text-white font-semibold">Total de usuarios registrados</h3>
          <p id="totalUsuarios" class="text-2xl text-gray-900 dark:text-white font-bold" >—</p>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 text-center">
          <h3 class="text-lg text-gray-900 dark:text-white font-semibold">Quests completadas hoy</h3>
          <p class="text-2xl text-gray-900 dark:text-white font-bold">128</p>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 text-center">
          <h3 class="text-lg text-gray-900 dark:text-white font-semibold">Tasa de retención semanal</h3>
          <p class="text-2xl text-gray-900 dark:text-white font-bold">73%</p>
        </div>
      </div>

      <!-- Charts -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6">
        <div id="nationality-chart" style="width: 100%; height: 400px;"></div>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6">
        <div id="main" style="width: 100%; height: 400px;"></div>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6">
        <div id="quest-chart" style="width: 100%; height: 400px;"></div>
      </div>

      <!-- Error box -->
      <div id="errorBox" class="hidden"></div>
    </main>

    <script src="https://unpkg.com/flowbite@1.6.5/dist/flowbite.min.js"></script>
    <script type="module" src="./javascript/dashboard.mjs"></script>
  </body>
</html>
