<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Settings - CryptoChicks</title>
        <link href="css/output.css" rel="stylesheet">
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body class="bg-gray-100 dark:bg-gray-900 flex">
        <script>
          // Prevent access if no token is present
          if (!localStorage.getItem('token')) {
            window.location.href = 'login.html';
          }
        </script>
        <script type="module">
          import { API_BASE, getAuthHeaders } from './javascript/api_url.mjs';
          (async () => {
            const res = await fetch(`${API_BASE}/check-auth`, { headers: getAuthHeaders() });
            if (res.status !== 200) {
              window.location.href = 'login.html';
            }
          })();
        </script>
        <!-- Navbar cargado dinámicamente -->
        <div id="navbar-placeholder"></div>
        <script>
            fetch('./partials/navbar.html')
            .then(res => {
                if (!res.ok) {
                    throw new Error('Error al cargar la barra de navegación');
                }
                return res.text();
            })
            .then(html => {
                const container = document.getElementById('navbar-placeholder');
                container.innerHTML = html;
                const logoutBtn = container.querySelector('#logout-btn');
                if (logoutBtn) {
                  logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('token');
                    window.location.href = 'logout.html';
                  });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('navbar-placeholder').innerHTML = '<div class="fixed w-16 h-screen bg-gray-800 text-white p-4">Error al cargar</div>';
            });
        </script>

        <!-- Main -->
        <main class="flex-1 p-10 flex justify-center space-x-10 pt-32 pr-4 pb-4 pl-4">
            <!-- Mensaje de estado -->
            <div id="statusMessage" class="fixed top-4 right-4 hidden"></div>

            <!-- Create New User -->
            <form id="createUserForm" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md w-96">
                <h2 class="text-xl font-bold mb-4">Crear Usuario Admin</h2>

                <label class="block mb-2">Nombre</label>
                <input type="text" id="usernameField" name="username" placeholder="Nombre del usuario" required class="w-full p-2 mb-4 border rounded-md text-black">

                <label class="block mb-2">Email</label>
                <input type="email" id="emailField" name="email" placeholder="Correo electrónico" required class="w-full p-2 mb-4 border rounded-md text-black">

                <label class="block mb-2">Rol</label>
                <select id="roleField"
                        name="role"
                        required
                        class="w-full p-2 mb-4 border rounded-md text-black">
                    <option value="Admin">Admin</option>
                    <option value="Analista">Analista</option>
                </select>

                <label class="block mb-2">Contraseña</label>
                <input type="password" id="passwordField" name="password" placeholder="Contraseña" required class="w-full p-2 mb-4 border rounded-md text-black">

                <button type="submit"
                        id="saveUserButton"
                        class="w-full bg-pink-500 text-white py-2 rounded-md hover:bg-pink-600">
                    Crear Usuario
                </button>
            </form>

            <!-- Delete User -->
            <form id="deleteUserForm" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md w-96">
                <h2 class="text-xl font-bold mb-4">Eliminar Usuario Admin</h2>

                <label class="block mb-2">Email</label>
                <input type="email" id="emailToDelete" name="email" placeholder="Correo del usuario a eliminar" required class="w-full p-2 mb-4 border rounded-md text-black">

                <button type="submit"
                        id="deleteUserButton"
                        class="w-full bg-red-500 text-white py-2 rounded-md hover:bg-red-600">
                    Eliminar Usuario
                </button>
            </form>
        </main>

        <!-- End Message -->
        <div id="endMessage" class="hidden fixed bottom-4 right-4 bg-green-100 p-4 rounded-lg shadow-md">
            <p id="result" class="text-green-700 mb-2"></p>
            <a href="/settings.html" class="text-blue-500 hover:underline">Volver</a>
        </div>

        <!-- Scripts -->
        <script type="module" src="./javascript/api_url.mjs"></script>
        <script type="module" src="./javascript/settings.mjs"></script>
        <script src="https://unpkg.com/flowbite@1.6.5/dist/flowbite.min.js"></script>
    </body>
</html>